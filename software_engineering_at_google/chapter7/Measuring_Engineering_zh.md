# <center>第七章 工程生产力的测量</center>

<p align="right"> Ciera Jaspen著 </p>

<p align="right">Riona Macnamara编辑</p>

谷歌是数据驱动的公司。我们使用硬数据备份我们的大多数产品和设计决策。使用适当的度量标准进行数据驱动决策的文化存在一些缺陷，但是总的来说，依赖数据往往会使大多数决策是客观的而不是主观的，这通常是一件好事。但是，从人的角度收集和分析数据也有其自身的挑战。具体来说，在软件工程领域，Google发现拥有一支由专家组成的团队来专注于工程生产力本身就非常有价值，并且随着公司规模的扩大而发挥了重要作用，并且可以利用来自该团队的见解。

## 为什么我们需要测量工程生产力



让我们假设您有蓬勃发展的业务（例如，您在运行一个在线搜索引擎），并且您希望扩展业务范围（进入企业应用市场，或云市场或移动市场）。据推测，为了扩展业务范围，您需要增加工程组织的规模。然而，随着组织规模的线性增大，传播成本成倍增长。对于扩展业务而言增加更多的人是必要的，但通信开销成本不会跟人员一样线性增加的。作为结果，您无法将业务范围线性扩展到工程组织的规模。

尽管如此，还有另一种方法可以解决我们的规模问题：我们可以让每个人更有生产力。如果我们可以提高组织单一工程师的生产率，我们可以增加业务范围，而无需增加沟通开销。

谷歌必须迅速发展到新的业务，这意味着需要学习如何使我们的工程师更加富有成效。为此，我们需要了解什么使他们高效，识别我们的工程流程中的低效内容，并解决这些确定的问题。然后，我们将根据需要在持续改进循环中重复这个过程。通过这样做，我们将能够使我们的工程组织跟上需求的增加。

但是，此改进周期也需要人力资源。如果每年要花费50名工程师来了解和修复生产力障碍，那么对于每年增加10名工程师的工程师组织就没有任何意义。因此，我们的目标不仅是提高软件工程效率，而且要有效地做到这一点。

在Google，我们通过创建一个致力于理解工程生产力的研究人员团队来解决这些权衡问题。我们的研究团队包括来自软件工程研究领域的人员和软件通才工程师，除此之外我们还包括来自各个领域的社会科学家，包括认知心理学和行为经济学。来自社会科学领域的人员的加入使我们不仅可以研究工程师生产的软件工件，还可以了解软件开发的人性化方面，包括个人动机，激励结构和管理复杂任务的策略。团队的目标是采用数据驱动的方法来衡量和提高工程效率。

在本章中，我们将逐步介绍我们的研究团队如何实现这一目标。这从分类流程开始：我们可以衡量软件开发的许多部分，但是我们应该衡量什么呢？选择项目后，我们将逐步研究团队如何确定有意义的指标，这些指标将确定流程中有问题的部分。最后，我们看看Google如何使用这些指标来跟踪生产力的提高。

在本章中，我们遵循Google的C++和Java语言团队提出的一个具体示例：可读性。在Google的大部分生存时间中，这些团队都负责管理Google的可读性过程。（有关可读性的更多信息，请参见第3章。）可读性过程是在Google早期建立的，在此之前，自动格式化程序（第8章）和块提交的代码美化变得司空见惯（第9章）。该过程本身的运行成本很高，因为它需要数百名工程师对其他工程师进行可读性检查，才能赋予他们可读性。一些工程师将其视为不再具有效用的古老的模糊过程，并且这是在午餐餐桌上争论不休的一个热门话题。语言团队的具体问题是：花在可读性过程上的时间是否值得？

 

## 分流：是否值得衡量

在决定如何衡量工程师的生产力之前，我们需要知道什么时候一个指标值得衡量。度量本身很昂贵：需要人员来度量过程，分析结果并将其分发给公司的其他部门。此外，测量过程本身可能很繁琐，并拖慢了工程部门的其他工作。即使进度不是很慢，跟踪进度也可能会改变工程师的行为，可能会掩盖潜在问题。我们需要明智地进行测量和估算；尽管我们不想猜测，但我们不应该浪费时间和资源进行不必要的评估。

在Google，我们提出了一系列问题，以帮助团队确定是否值得一开始就衡量生产力。我们首先要求人们以具体问题的形式描述他们想要衡量的内容；我们发现，人们提出的问题越多，他们越有可能从该过程中受益。当可读性团队与我们联系时，问题很简单：经过可读性过程的工程师的成本是否值得他们可能为公司带来的利益？

然后，我们向他们询问他们问题的以下各个方面：

**你期待什么样的结果，为什么？**

即使我们可能假装我们是中立的调查员，但事实并非如此。我们确实对应该发生的事情有先入为主的观念。通过一开始就承认这一点，我们可以尝试解决这些偏见并避免事后对结果的解释。

当向可读性小组提出这个问题时，它指出并不确定。人们可以肯定，成本在某个时间点上已经物有所值，但是随着自动格式化程序和静态分析工具的出现，没有人可以完全确定。越来越多的人认为，该过程现在已成为一项艰巨的仪式。尽管它仍然可以为工程师带来好处（他们的调查数据表明人们确实声称拥有这些好处），但尚不清楚是否值得代码作者或代码审阅者投入时间。

**如果数据支持您的预期结果，将采取哪些操作？**

我们之所以这样问，是因为如果不采取任何行动，那么就没有测量点。请注意，如果没有这样的结果，那么如果计划有变，实际上这项操作可能是“维持现状”的行动。

当被问到这一点时，可读性团队的回答很简单：如果好处足以证明流程成本合理，他们将链接到有关可读性的研究和常见问题解答上的数据，并宣传它以设定期望值。

**如果我们得到负面的结果，会采取适当的措施吗？**

我们问这个问题，是因为在许多情况下，我们发现负面结果不会改变决定。决策中可能还有其他输入可能会覆盖所有的负面结果。如果真是这样，那么一开始就不值得进行评估。这个问题使我们的研究团队将进行中的大多数项目都停止了。我们了解到决策者有兴趣了解结果，但是由于其他原因，他们不会选择改变方向。

但是，在可读性方面，我们的团队有一个强有力的行动声明。它承诺，如果我们的分析表明成本超过了收益或收益可忽略不计，则团队将终止该过程。由于不同的编程语言在格式化程序和静态分析中具有不同的成熟度，因此这种评估将在每种语言的基础上进行。

**谁将决定对结果采取行动，他们什么时候会采取行动？**

我们要求这样做以确保要求进行测量的人是有权采取行动（或直接代表他们采取行动）的人。最终，衡量我们的软件流程的目的是帮助人们做出业务决策。重要的是要了解那个人是谁，包括用什么形式的数据说服他们。尽管最好的研究包括多种方法（从结构化访谈到日志统计分析的所有方法），但在有限的时间内只可能为决策者提供了他们所需的数据。在这种情况下，最好的做法是迎合决策者。他们倾向于通过倾听从访谈中获取的故事来做出决策吗？2他们是否信任调查结果或记录数据？他们对复杂的统计分析感到满意吗？如果决策者原则上不相信结果的形式，那么衡量过程也就没有意义了。

在可读性方面，我们对每种编程语言都有明确的决策者。Java和C++这两个语言团队积极地向我们寻求帮助，其他团队则首先等着看这些语言发生了什么。决策者们信任工程师的自我报告经验，以理解幸福和学习，但是决策者希望看到基于日志数据的“硬数字”，以了解速度和代码质量。这意味着我们需要对这些指标进行定性和定量分析。这项工作没有一个艰巨的截止日期，但是有一次内部会议，如果要进行更改，这将是一个有用的时间来宣布。这个截止日期给了我们几个月的时间来完成这项工作。

通过问这些问题，我们发现在很多情况下，测量根本不值得……这没关系！有很多充分的理由不去衡量工具或过程对生产率的影响。以下是一些我们看到的示例：

**您现在无力更改流程/工具**

可能有时间限制或财务限制阻止了这种情况。例如，您可能确定如果仅切换到更快的构建工具，则可以每周节省几个小时的时间。但是，转换将意味着在每个人都在转换的过程中暂停开发，并且可能临近主要的资金截止日期，以致您无法承受中断。工程性的权衡并非凭空评估的，在这种情况下，重要的是要认识到更广泛的上下文完全可以证明对结果采取延迟行动是合理的。

**任何结果很快都会因其他因素而失效**

这里的示例可能包括在计划的重组之前测量组织的软件过程。或衡量已过时系统的技术债务金额。

决策者有很强的见解，您不太可能提供足够多的正确类型的证据来改变他们的信念。

这归结为了解您的听众。即使在Google上，我们有时也会发现由于过去的经历而对主题保持坚定信念的人们。我们发现利益相关者从不信任调查数据，因为他们不相信自己的报告。我们还发现，在少数访谈的启发下，令人信服的叙述最能打动您的利益相关者。当然，也有一些利益相关者只受到日志分析的影响。在所有情况下，我们都尝试使用混合方法对真相进行三角剖分，但是如果利益相关者仅限于相信方法不适合该问题，那么进行此工作是没有意义的。

**结果将仅用作虚指标，以支持您无论如何都要做的事情**

这也许是我们告诉Google员工不要衡量软件过程的最常见原因。很多时候，人们已经为多个原因计划了一个决策，而改善软件开发过程只是其中几个好处。例如，Google的发布工具团队曾经要求对发布的工作流程系统的计划变更进行评估。由于变更的性质，很明显，变更不会比当前状态更糟，但是他们不知道这是次要的改进还是大的改进。我们问了团队：如果事实证明这只是个小小的改进，即使它看起来不值得投资，您是否仍会花费资源来实施该功能？答案是肯定的！该功能的确提高了生产率，但这是一个附带的作用：它还具有更高的性能，并减轻了发布工具团队的维护负担。

**唯一可用的度量标准不够精确，无法衡量问题，并且可能会与其他因素混淆**

在某些情况下，根本无法获得所需的度量标准（请参阅有关如何识别度量标准的下一部分）。在这些情况下，使用不那么精确的其他度量（例如，编写的代码行）进行度量可能很诱人。但是，这些指标的任何结果都是无法解释的。如果该度量标准确认了利益相关者的先前信念，那么他们可能最终会继续进行计划，而不考虑该度量标准不是一种准确的度量标准。如果度量标准不能证实他们的信念，那么度量标准本身的不精确性就可以提供一个简单的解释，利益相关者可以再次执行他们的计划。

成功衡量软件过程时，您并没有打算证明假设是正确的还是不正确的；成功意味着为利益相关者提供决策所需的数据。如果那个利益相关者不会使用数据，那么该项目将永远是失败的。仅当根据结果做出具体决定时，我们才应该衡量软件过程。对于可读性团队，需要做出明确的决定。如果度量标准表明该过程是有益的，则可以公布结果。如果没有，该过程将被取消。最重要的是，可读性团队有权做出此决定。

## 选择具有目标和信号的有意义的指标

在决定衡量软件过程之后，我们需要确定要使用的指标。显然，代码行（LOC）行，但是我们如何实际衡量工程生产率？

在Google，我们使用目标/信号/指标（GSM）框架来指导指标创建。

•目标是理想的最终结果。它是根据您想从更高层次上理解的内容来表达的，不应包含特定的衡量方式的参考。

•一个信号就是您可能会知道自己已达到最终结果的方式。信号是我们想要测量的东西，但它们自己可能无法测量。

•度量是信号的代理。这是我们实际上可以衡量的事情。这可能不是理想的测量方法，但是我们认为这已经足够接近了。

GSM框架在创建指标时会鼓励一些理想的属性。首先，通过首先创建目标，然后创建信号，最后创建指标，可以防止路灯效应。该术语来自完整的短语“在路灯下寻找钥匙”：如果只看可以看到的地方，则可能找不到正确的位置。使用度量标准时，无论我们使用的度量标准是否满足我们的需求，都会发生这种情况。取而代之的是，GSM迫使我们考虑哪些指标将真正帮助我们实现目标，而不是简单地获取现有指标。

其次，GSM通过鼓励我们在实际测量结果之前提出一种有原则的方法来提出一组适当的度量标准，从而帮助防止度量标准蠕变和度量标准偏差。考虑以下情况：我们在没有原则性方法的情况下选择指标，然后结果不符合利益相关者的期望。到那时，我们冒着风险，利益相关者会建议我们使用他们认为会产生预期结果的不同指标。而且由于一开始我们并不是基于原则性的方法进行选择，因此没有理由说出它们是错误的！取而代之的是，GSM鼓励我们根据衡量原始目标的能力来选择指标。利益相关者可以轻松地看到这些指标映射到其原始目标，并事先同意这是衡量结果的最佳指标集。

最后，GSM可以向我们展示我们在哪些方面具有测量覆盖范围，而在哪些方面则没有。当我们执行GSM流程时，我们列出了所有目标并为每个目标创建信号。正如我们将在示例中看到的那样，并不是所有信号都可以测量到的-没关系！使用GSM，至少我们已经确定了不可测量的东西。通过识别这些缺失的指标，我们可以评估是值得创建新的算法还是值得进行测量。

重要的是保持可追溯性。对于每个度量，我们应该能够追溯到它打算作为代理的信号以及它试图度量的目标。这样可以确保我们知道我们要衡量哪些指标以及为什么要对其进行衡量。

## 目标

应该根据所需的属性来编写目标，而不参考任何度量标准。这些目标本身是无法衡量的，但是在继续研究信号和度量标准之前，每个人都可以达成一套良好的目标。为了使这项工作奏效，我们首先需要确定要衡量的正确目标集。这看起来很简单：团队肯定知道他们的工作目标！但是，我们的研究团队发现，在许多情况下，人们会忘记将所有可能的折衷包括在生产率之内，这可能导致计量错误。

以可读性为例，假设团队专注于使可读性过程快速便捷，以至于忘记了代码质量的目标。团队建立了跟踪度量，以了解完成审核过程需要多长时间以及工程师对审核过程的满意程度。我们的一名队友提出以下建议：

**我可以使您的审查速度非常快：只需完全删除代码审查即可。**

尽管这显然是一个极端的例子，但团队在测量时始终忘却了核心权衡：他们过于专注于提高速度以至于他们忘记了测量质量（反之亦然）。为了解决这个问题，我们的研究团队将生产率分为五个核心组成部分。这五个组成部分相互取舍，我们鼓励团队考虑每个组成部分中的目标，以确保它们不会在无意间提高一个目标的同时又将其他因素推向低端。为了帮助人们记住所有五个组成部分，我们使用助记符“QUANTS”:

代码质量

产生的代码质量如何？测试用例足够好来预测回归吗？架构在降低风险和变更方面有多好？

